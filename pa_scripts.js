//Menuwrap icons
function waitForElement(e,t){const n=new MutationObserver((i=>{for(const o of i)if("childList"===o.type){const i=document.querySelector(e);if(i){n.disconnect(),t(i);break}}})),i=document.querySelector(".menuwrap");i&&n.observe(i,{childList:!0,subtree:!0})}function addIdsToMenuItems(e){if(e.dataset.menuProcessed)return;e.dataset.menuProcessed="true";const t=e.querySelector(".left");t&&(t.style.visibility="visible");const n=new Set;e.querySelectorAll(".left li.menu").forEach((e=>{const t=e.querySelector("a");if(t&&!n.has(t)){n.add(t);const i=t.getAttribute("href"),o=t.querySelector("span")?.innerHTML.trim();e.querySelector(".nick")?e.id="nick":"https://msg.forumcommunity.net/?act=Msg&CODE=01&c=655775"===i?e.id="messenger":"https://msg.forumcommunity.net/?act=UserCP&CODE=26&c=655775"===i?e.id="topics":"#notifications"===i?e.id="notif":e.querySelector('form[action="/?act=Mod"]')||["&nbsp;Moderation","&nbsp;Moderazione","&nbsp;Moderación","&nbsp;Modération","&nbsp;Mäßigung","&nbsp;Moderação"].includes(o)?e.id="mod":(["&nbsp;Administration","&nbsp;Amministrazione","&nbsp;Administración","&nbsp;Verwaltung","&nbsp;Administração"].includes(o)||"https://www.forumcommunity.net/?cid=655775"===i)&&(e.id="admin"),"&nbsp;Messenger"===o&&(e.id="messenger")}})),e.querySelectorAll(".left li:not(.menu)").forEach((e=>{const t=e.querySelector("a");if(t&&!n.has(t)){n.add(t);const i=t.textContent.trim();"HOME"===i?e.id="pahome":"/latestupdates"===t.getAttribute("href")&&(e.id="updates")}}))}waitForElement(".menuwrap",addIdsToMenuItems);
//Mobile sidebar
(function(){'use strict';if(document.querySelector(".mobile-menu-toggle"))return;const m=()=>{if(!document.body.classList.contains("mobile")||document.querySelector(".mobile-menu-toggle"))return;const e=document.querySelector(".menuwrap");if(!e)return;const t=e.querySelector(".left");if(!t)return;const i=[];[t.querySelector('a[href="#notifications"]'),t.querySelector(".st-emoji-link-void")].forEach(n=>{n&&i.push(n.closest("li"))});const o=e.querySelector(".right");const c=o?.querySelector('a[href="/?act=Members"]')?.closest("li");const l=`<div class="mobile-menu-container"><button class="mobile-menu-toggle" type="button" aria-label="Toggle menu"><i class="fa-regular fa-bars"></i></button><div class="mobile-sidebar-overlay"></div><div class="mobile-sidebar"><div class="mobile-sidebar-header"><button class="mobile-sidebar-close" type="button" aria-label="Close menu"><i class="fa-regular fa-times"></i></button><h3>Menu</h3></div><div class="mobile-sidebar-content"></div></div></div>`;t.insertAdjacentHTML("beforebegin",l);o?.remove();const[s,u,d,m,f,b]=[".mobile-sidebar",".mobile-sidebar-content",".mobile-sidebar-overlay",".mobile-menu-toggle",".mobile-sidebar-close",".mobile-menu-container"].map(q=>document.querySelector(q));let y=!1;const v=()=>{const e=[];if(document.body.classList.contains("guest")){const i=t.querySelector("li.login");i&&e.unshift({t:"Sign In / Register",i:[{y:"login",e:i}],l:!0})}t.querySelectorAll("li").forEach(t=>{if(i.includes(t)||t.classList.contains("login"))return;const o=t.querySelector("a"),n=t.querySelector("ul"),c=o?.querySelector(".avatar")&&o.querySelector(".nick");if(c){const i=o.querySelector(".nick")?.textContent.trim()||"Profile";e.unshift({t:i,i:Array.from(n?.querySelectorAll("li")||[]).map(e=>({y:"link",e})),s:!0,u:!0})}else if(n&&!c){const i=o?.textContent.trim()||"Menu",c=t.classList.contains("submenu")&&t.classList.contains("alternative");e.push({t:i,i:Array.from(n.querySelectorAll("li")).map(e=>({y:"link",e})),s:!0,a:c})}});return c&&e.push({t:"Community",i:[{y:"link",e:c}]}),e};const g=()=>{const e=v();u.innerHTML=e.map(e=>{const i=e.l?"mobile-login-form":"",o=e.s&&!e.l?'class="mobile-submenu-title clickable"':'class="mobile-menu-category-title"',n=e.s&&!e.l?' <i class="fa-regular fa-chevron-down mobile-submenu-chevron"></i>':"",c=e.l?"mobile-login-content":"mobile-menu-category-list",l=e.a?"mobile-submenu-alternative":"",s=e.i.map(t=>{if("login"===t.y){const e=t.e.cloneNode(!0),i=e.querySelector("form, .login_with");return i?i.outerHTML:e.outerHTML}const i=t.e.cloneNode(!0),o=i.querySelector('a[onclick*="Logout.submit"]');if(o){const e=i.querySelector('form[name="Logout"]');e&&(o.onclick=t=>{t.preventDefault(),e.submit(),k();return!1})}return i.outerHTML}).join("");return`<div class="mobile-menu-container ${i}"><div ${o}>${e.t}${n}</div><div class="${c} ${l}">${s}</div></div>`}).join("")};const h=()=>{u.querySelectorAll(".mobile-submenu-title").forEach(e=>{e.onclick=function(){const e=this.classList.contains("active");u.querySelectorAll(".mobile-menu-category-list, .mobile-submenu-chevron, .mobile-submenu-title").forEach(e=>e.classList.remove("active")),e||(this.nextElementSibling.classList.add("active"),this.querySelector(".mobile-submenu-chevron").classList.add("active"),this.classList.add("active"))}});u.onclick=e=>{const t=e.target;if(t.matches("a")&&!t.closest(".mobile-submenu-title")&&!t.onclick?.toString().includes("Logout.submit"))k();else if(t.matches(".login_with button[data-url]")){e.preventDefault();const i=t.getAttribute("data-service"),o=t.getAttribute("data-url");document.cookie=`social-login=${i};max-age=315360000;path=/`,location.href=o}}};const p=()=>{s.classList.add("active"),d.classList.add("active"),document.body.style.overflow="hidden",y=!0};const k=()=>{s.classList.remove("active"),d.classList.remove("active"),document.body.style.overflow="",y=!1,u.querySelectorAll(".mobile-menu-category-list, .mobile-submenu-chevron, .mobile-submenu-title").forEach(e=>e.classList.remove("active"))};const L=()=>y?k():p();m.onclick=e=>(e.stopPropagation(),L());[f,d].forEach(e=>e.onclick=k);document.onclick=e=>{y&&!s.contains(e.target)&&!b.contains(e.target)&&k()};s.onclick=e=>e.stopPropagation();document.onkeydown=e=>{y&&"Escape"===e.key&&k()};const S=new MutationObserver(g);S.observe(t,{childList:!0,subtree:!0});let E;window.onresize=()=>{clearTimeout(E),E=setTimeout(m,250)};window.addEventListener("beforeunload",()=>{S.disconnect(),clearTimeout(E)});g(),h()};m();new MutationObserver(e=>{e.some(e=>"class"===e.attributeName)&&m()}).observe(document.body,{attributes:!0})})();
//Latest posts slider
class TopicSlider{constructor(){this.topics=[],this.currentIndex=0,this.interval=null,this.sliderDuration=3e3,this.sliderHeight=40,this.isAnimating=!1,this.init()}init(){this.collectTopics(),this.createFixedHeightSlider(),this.setupEvents(),this.topics.length>1?this.startAutoSlide():this.hideNavigation()}collectTopics(){document.querySelectorAll(".lastarticles .topic").forEach(e=>{const t=e.querySelector('b[class^="f"]')?.className||"";this.topics.push({element:e.cloneNode(!0),folder:t})})}createFixedHeightSlider(){const e=document.querySelector(".lastarticles");e.innerHTML=`<div class="topic_slider" style="height: ${this.sliderHeight}px; position: relative; overflow: hidden;"><div class="center" style="height: 100%;"><div class="slider_main" style="height: 100%; position: relative;"></div></div><div class="right"><a id="sliderTopicPrev"><i class="fa-regular fa-chevron-left"></i></a><a id="sliderTopicNext"><i class="fa-regular fa-chevron-right"></i></a></div></div>`,e.style.display="block",this.showCurrentTopic()}showCurrentTopic(){const e=document.querySelector(".topic_slider .center .slider_main");e.innerHTML="",0===this.topics.length?e.innerHTML='<div class="topic" style="height: 100%; display: flex; align-items: center; justify-content: center;"><i>No topic present.</i></div>':((e,t)=>{const o=this.topics[this.currentIndex].element.cloneNode(!0);o.style.height="100%",o.style.display="flex",o.style.alignItems="center",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.transition="transform 0.382s ease",o.style.transform="translateY(0)",e.appendChild(o)})(e)}transitionToNext(){if(this.isAnimating||this.topics.length<=1)return;this.isAnimating=!0;const e=document.querySelector(".topic_slider .center .slider_main .topic");if(e){e.style.transform="translateY(-100%)";const t=(this.currentIndex+1)%this.topics.length,o=this.topics[t].element.cloneNode(!0);o.style.height="100%",o.style.display="flex",o.style.alignItems="center",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.transition="transform 0.382s ease",o.style.transform="translateY(100%)",e.parentNode.appendChild(o),setTimeout(()=>{o.style.transform="translateY(0)"},50),setTimeout(()=>{e.parentNode&&e.remove(),this.currentIndex=t,this.isAnimating=!1},500)}else this.isAnimating=!1}transitionToPrev(){if(this.isAnimating||this.topics.length<=1)return;this.isAnimating=!0;const e=document.querySelector(".topic_slider .center .slider_main .topic");if(e){e.style.transform="translateY(100%)";const t=this.currentIndex>0?this.currentIndex-1:this.topics.length-1,o=this.topics[t].element.cloneNode(!0);o.style.height="100%",o.style.display="flex",o.style.alignItems="center",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.transition="transform 0.382s ease",o.style.transform="translateY(-100%)",e.parentNode.insertBefore(o,e.parentNode.firstChild),setTimeout(()=>{o.style.transform="translateY(0)"},50),setTimeout(()=>{e.parentNode&&e.remove(),this.currentIndex=t,this.isAnimating=!1},500)}else this.isAnimating=!1}setupEvents(){document.addEventListener("click",e=>{e.target.closest("#sliderTopicNext")?this.handleNext():e.target.closest("#sliderTopicPrev")&&this.handlePrev()});const e=document.querySelector(".topic_slider");e.addEventListener("mouseenter",()=>this.stopAutoSlide()),e.addEventListener("mouseleave",()=>{this.topics.length>1&&this.startAutoSlide()})}handleNext(){this.stopAutoSlide(),this.transitionToNext(),setTimeout(()=>{this.topics.length>1&&this.startAutoSlide()},this.sliderDuration)}handlePrev(){this.stopAutoSlide(),this.transitionToPrev(),setTimeout(()=>{this.topics.length>1&&this.startAutoSlide()},this.sliderDuration)}startAutoSlide(){this.topics.length<=1||this.interval||(this.interval=setInterval(()=>{this.isAnimating||this.transitionToNext()},this.sliderDuration))}stopAutoSlide(){this.interval&&(clearInterval(this.interval),this.interval=null)}hideNavigation(){document.querySelectorAll("#sliderTopicNext, #sliderTopicPrev").forEach(e=>{e.style.display="none"})}}new TopicSlider;
//Avatar pack
!function(){const e=["#ff7770","#ff6b6b","#ff5154","#ffcb69","#fdc26d","#ffa96c","#ff9f1c","#ff8f5c","#9ce37d","#74c365","#16c172","#3ab795","#4ecdc4","#2dc7ff","#0eb1d2","#009bf5","#a3bcf9","#9b9ece","#9792e3","#8075ff","#b455b0","#a755c2","#a5acb5","#889696"],t=["https://res.cloudinary.com/dbdf6gwgo/image/upload/v1674337715/forum/Avatar/default_avatar_zpw3zz.svg","https://res.cloudinary.com/dbdf6gwgo/image/upload/v1676109015/forum/Avatar/robot_snynw7.svg","https://img.forumfree.net/style_images/default_avatar.png","https://img.forumfree.net/style_images/default_avatar_bot.png"],s=new Map,o=new WeakMap,a=new WeakMap;function r(t){const s=document.createElement("span");return s.className="avatar",s.textContent=function(e){const t=e.match(/[A-Za-z]/);return t?t[0].toUpperCase():e.match(/[0-9]/)?.[0]||e.match(/[^A-Za-z0-9]/)?.[0]||"?"}(t),s.setAttribute("alt",t),s.style.backgroundColor=e[Math.min(Math.floor(t.length/Math.ceil(1/e.length)),e.length-1)],s}function c(e,s,o,a,l){const c=document.createElement("a");if(c.className="avatar",c.href=o,e&&!t.includes(e.src)){const t=document.createElement("img");return t.setAttribute("src",e.src),t.setAttribute("decoding","async"),t.setAttribute("alt",l||s.textContent.trim()),t.onerror=function(){const e=l||s.textContent.trim(),o=r(e);c.innerHTML="",c.appendChild(o)},c.appendChild(t),c}else{const e=l||s.textContent.trim(),t=r(e);return c.appendChild(t),c}}async function n(e,t,o){const a=e.href;if(s.has(a)){const e=s.get(a);if(e.failed)return void i(c(null,t,a),o);i(c(e.profileAvatarImg,t,a,e.fullName),o)}else try{const e=await fetch(a),r=await e.text(),n=(new DOMParser).parseFromString(r,"text/html"),l=n.querySelector(".profile .avatar img"),d=n.querySelector(".profile .nick")?.textContent.trim();l||d?(s.set(a,{profileAvatarImg:l,fullName:d,failed:!1}),i(c(l,t,a,d),o)):(s.set(a,{failed:!0}),i(c(null,t,a),o))}catch{s.set(a,{failed:!0}),i(c(null,t,a),o)}}function i(e,t){const s=o.get(t)||{summary:t.closest(".summary .list li"),popup:t.closest(".popup.pop_points ol.users li"),boardStats:t.closest(".stats .zz .users li"),sideStats:t.closest(".side_stats.sidebox .users li"),tagObject:t.closest("#tagObject li"),emojiPostAuthor:t.closest(".st-emoji-epost-author"),sendMainBg:t.closest(".send .mainbg")};o.set(t,s);const{summary:a,popup:r,boardStats:c,sideStats:n,tagObject:i,emojiPostAuthor:l,sendMainBg:d}=s;if(a){const s=t.querySelector(".left.Sub.Item");if(s){const t=document.createElement("div");t.className="summary_details";const o=s.querySelector(".nick");o&&t.appendChild(o),t.appendChild(e),s.insertBefore(t,s.firstChild)}}else if(r&&document.body.matches("#topic, #search"))!t.querySelector(".avatar")&&t.insertBefore(e,t.firstChild);else if(c&&document.body.matches("#board"))!t.querySelector(".avatar")&&t.insertBefore(e,t.firstChild);else if(n&&document.body.matches("#blog"))!t.querySelector(".avatar")&&t.insertBefore(e,t.firstChild);else if(i&&document.body.matches("#board"))!t.querySelector(".avatar")&&t.insertBefore(e,t.firstChild);else if(l&&document.body.matches("#topic"))(!t.previousElementSibling||!t.previousElementSibling.classList.contains("avatar"))&&t.parentNode.insertBefore(e,t);else if(d||t.closest(".send")){const s=document.createElement("div");s.className="send_av",s.appendChild(e);const n=(d||t.closest(".send")).querySelector(".send_av");n||t.previousElementSibling&&t.previousElementSibling.classList.contains("send_av")||t.parentNode.insertBefore(s,t)}else(!t.previousElementSibling||!t.previousElementSibling.classList.contains("avatar"))&&t.parentNode.insertBefore(e,t)}async function l(e){await Promise.all((Array.isArray(e)?e:[e]).map((async e=>{const t=a.get(e)?.userLink||e.querySelector('a[href*="act=Profile&MID="]');t&&(a.set(e,{userLink:t}),await n(t,t,e))})))}function d(){let e=a.get(document)?.userLink||document.querySelector('.menuwrap .left .menu:first-child a[href*="act=Profile&MID="]'),t=a.get(document)?.sendMainBg||document.querySelector(".send .mainbg");if(e&&t){const s=e.href.match(/MID=\d+/)?.[0];if(s){const o=document.querySelector(".onln .users a[href*='" + s + "']");o&&(e=o)}a.set(document,{userLink:e,sendMainBg:t}),n(e,e,t)}}new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.length>0&&document.querySelector(".send .mainbg")&&d()}))})).observe(document.body,{childList:!0,subtree:!0}),new MutationObserver((e=>{const t=[{selector:".big_list .zz .who",bodyMatches:"#board, #forum, #blog, #search"},{selector:".popup.pop_points ol.users li",bodyMatches:"#topic, #search"},{selector:".st-emoji-epost-author",bodyMatches:"#topic"},{selector:".stats .zz .users li",bodyMatches:"#board"},{selector:".side_stats.sidebox .users li",bodyMatches:"#blog"},{selector:"#tagObject li",bodyMatches:"#board"},{selector:".summary .list li",bodyMatches:"#send"},{selector:".post .details",bodyMatches:"#topic, #send"}];e.forEach((e=>{const s=Array.from(e.addedNodes).filter((e=>1===e.nodeType));if(s.length>0){const e=new Set;t.forEach((({selector:t,bodyMatches:o})=>{document.body.matches(o)&&s.forEach((s=>{s.matches(t)?e.add(s):s.querySelectorAll(t).forEach((t=>e.add(t)))}))})),e.size>0&&l(Array.from(e))}}))})).observe(document.body,{childList:!0,subtree:!0}),[{selector:"#tagObject li",bodyMatches:"#board"},{selector:".big_list .zz .who",bodyMatches:"#board, #forum, #blog, #search"},{selector:".popup.pop_points ol.users li",bodyMatches:"#topic, #search"},{selector:".st-emoji-epost-author",bodyMatches:"#topic"},{selector:".stats .zz .users li",bodyMatches:"#board"},{selector:".side_stats.sidebox .users li",bodyMatches:"#blog"},{selector:".summary .list li",bodyMatches:"#send"}].forEach((({selector:e,bodyMatches:t})=>function(e,t){document.body.matches(t)&&l(Array.from(document.querySelectorAll(e)))}(e,t))),document.body.matches("#topic, #send")&&function(){if(document.body.matches("#topic, #send")){const e=document.createDocumentFragment();document.querySelectorAll(".post .details").forEach((t=>{if(!t.querySelector(".avatar")){const s=t.querySelector(".nick:not(a)");if(s&&!s.querySelector('a[href*="act=Profile&MID="]')){const o=r(s.textContent.trim());e.appendChild(o),t.insertBefore(e,t.firstChild)}}}))}}(),d()}();
//Avatar pack 2
!function(){const e=["#ff7770","#ff6b6b","#ff5154","#ffcb69","#fdc26d","#ffa96c","#ff9f1c","#ff8f5c","#9ce37d","#74c365","#16c172","#3ab795","#4ecdc4","#2dc7ff","#0eb1d2","#009bf5","#a3bcf9","#9b9ece","#9792e3","#8075ff","#b455b0","#a755c2","#a5acb5","#889696"];const t=["https://res.cloudinary.com/dbdf6gwgo/image/upload/v1674337715/forum/Avatar/default_avatar_zpw3zz.svg","https://res.cloudinary.com/dbdf6gwgo/image/upload/v1676109015/forum/Avatar/robot_snynw7.svg","https://img.forumfree.net/style_images/default_avatar.png","https://img.forumfree.net/style_images/default_avatar_bot.png"];const o=new Map;function i(e){const t=e.match(/[A-Za-z]/);if(t)return t[0].toUpperCase();const o=e.match(/[0-9]/);if(o)return o[0];return e.match(/[^A-Za-z0-9]/)?.[0]||"?"}function s(e){const t=i(e);const o=document.createElement("span");o.className="avatar";o.textContent=t;o.style.backgroundColor=r(e.length);return o}function r(t){const o=Math.ceil(1/e.length);const i=Math.min(Math.floor(t/o),e.length-1);return e[i]}async function n(e,t){const i=e.href;if(o.has(i)){const e=o.get(i);return e.failed?null:c(e,t)}try{const e=await fetch(i);const s=await e.text();const r=(new DOMParser).parseFromString(s,"text/html");const n=r.querySelector(".profile .avatar img");const a=r.querySelector(".profile .nick")?.textContent.trim();const l={profileAvatarImg:n,fullName:a,failed:!n&&!a};o.set(i,l);return c(l,t)}catch(e){console.error("Error fetching profile:",e);o.set(i,{failed:true});return null}}function c(e,o){if(e.failed||e.profileAvatarImg&&t.includes(e.profileAvatarImg.src)){const t=e.fullName||"?";const i=s(t);o.parentNode?.replaceChild(i,o);return true}else if(o.src&&t.includes(o.src)){const t=e.fullName||"?";const i=s(t);o.parentNode?.replaceChild(i,o);return true}return false}function a(e){const o=e.target;if(o.closest(".menuwrap .avatar")){const e=o.closest('a[href*="act=Profile&MID="]');if(e){n(e,o);return}}if(o.closest(".profile .avatar")){const e=document.querySelector(".profile .nick")?.textContent.trim()||"?";const t=s(e);o.parentNode.replaceChild(t,o);return}if(o.closest("#markdiv .list-users div")){const e=o.closest("#markdiv .list-users div");const t=e.querySelector("mark")?.textContent.trim()||e.dataset.name||"?";const i=s(t);o.parentNode?.replaceChild(i,o);return}if(t.includes(o.src)){const e=o.closest('a[href*="act=Profile&MID="]');if(e){n(e,o)}else{const e="?";const t=s(e);o.parentNode?.replaceChild(t,o)}}}function l(e){if(e.matches(".menuwrap .avatar, .menuwrap .avatar *")){const o=e.matches("img")?e:e.querySelector("img");if(o){o.addEventListener("error",a);if(t.includes(o.src)){const e=o.closest('a[href*="act=Profile&MID="]');if(e){n(e,o)}else{const e=o.closest(".menuwrap")?.querySelector(".nick")?.textContent.trim()||"?";const t=s(e);o.parentNode?.replaceChild(t,o)}}}return}if(document.body.matches("#topic")&&e.matches("#markdiv .list-users div, #markdiv .list-users div *")){const o=e.closest("#markdiv .list-users div")||e;if(o.matches("div")){const e=o.querySelector("img");if(e){if(t.includes(e.src)||e.complete&&e.naturalWidth===0){e.addEventListener("error",a);const t=o.querySelector("mark")?.textContent.trim()||o.dataset.name||"?";const i=s(t);e.parentNode?.replaceChild(i,e)}}}return}if(e.matches(".profile .avatar")){const o=e.querySelector("img");if(o){o.addEventListener("error",a);if(!o.complete||o.naturalWidth===0||t.includes(o.src)){const e=document.querySelector(".profile .nick")?.textContent.trim()||"?";const t=s(e);o.parentNode.replaceChild(t,o)}}return}if(document.body.matches("#topic")&&e.matches(".atwho-view-ul li, .atwho-view-ul li *")){const o=e.closest("li")||e;const i=o.querySelector("img");if(i&&t.includes(i.src)){i.addEventListener("error",a);const e=o.dataset.name||(()=>{const e=o.querySelector("strong");if(!e)return"?";let t=e.textContent.trim();const i=[];let s=e.nextSibling;while(s){if(s.nodeType===Node.TEXT_NODE){i.push(s.textContent.trim())}s=s.nextSibling}const r=i.join(" ").trim();if(r){t+=r}return t})();const t=s(e);i.parentNode?.replaceChild(t,i)}return}if(document.body.matches("#topic")&&e.matches("ul.ve-dropdown-list.ve-mention-list li, ul.ve-dropdown-list.ve-mention-list li *")){const o=e.closest("li")||e;const i=o.querySelector(".ve-mention-image img");if(i&&t.includes(i.src)){i.addEventListener("error",a);const e=o.querySelector(".ve-mention-label");const t=e?e.textContent.trim():"?";const r=s(t);i.parentNode?.replaceChild(r,i)}return}if(document.body.matches("#topic, #blog")&&e.matches(".post .left, .post .left *")){const o=e.querySelector('a[href*="act=Profile&MID="]');const i=e.querySelector(".avatar img");if(i){i.addEventListener("error",a);if(o){n(o,i)}else if(t.includes(i.src)){const e="?";const t=s(e);i.parentNode?.replaceChild(t,i)}}return}if(document.body.matches("#blog")&&e.matches("#centerdiv .title2.top.Item.Justify span.avatar.thumbs, #centerdiv .title2.top.Item.Justify span.avatar.thumbs *")){const o=e.closest("span.avatar.thumbs")||e;const i=o.querySelector("img");if(i&&t.includes(i.src)){i.addEventListener("error",a);const e=o.querySelector('a[href*="act=Profile&MID="]');if(e){n(e,i)}else{const e="?";const t=s(e);i.parentNode?.replaceChild(t,i)}}return}if(e.matches(".st-emoji-notice-item, .st-emoji-notice-item *")){const o=e.closest(".st-emoji-notice-item")||e;if(o.matches(".st-emoji-notice-item")){const e=o.querySelector(".st-emoji-notice-avatar img");if(e&&t.includes(e.src)){e.addEventListener("error",a);const t=o.querySelector('.st-emoji-notice-message a[href*="act=Profile&MID="]');if(t){n(t,e)}else{const t="?";const o=s(t);e.parentNode?.replaceChild(o,e)}}}return}if(e.matches(".st-emoji-user-list img, .st-emoji-user-avatar img, .st-emoji-user")){const o=e.matches("img")?e:e.querySelector(".st-emoji-user-avatar img");if(o){o.addEventListener("error",a);if(t.includes(o.src)){const t=o.closest('a[href*="act=Profile&MID="]');if(t){n(t,o)}else{const t=e.closest(".st-emoji-user")||o.closest(".st-emoji-user");const i=t?t.querySelector(".st-emoji-user-nick a"):null;const r=i?i.textContent.trim():"?";const n=s(r);o.parentNode?.replaceChild(n,o)}}}return}if(e.matches(".notification-container")){const o=e.querySelector(".notification-image .avatar img");if(o&&t.includes(o.src)){o.addEventListener("error",a);const t=e.querySelector(".notification-text b");if(t){const e=t.textContent.trim();const i=s(e);o.parentNode.replaceChild(i,o);return}const i=o.closest('a[href*="act=Profile&MID="]');if(i){n(i,o)}else{const e="?";const t=s(e);o.parentNode.replaceChild(t,o)}}return}if(document.body.matches("#profile")&&e.matches("#pop_profile .thumbs a")){const o=e.querySelector("img");if(o){o.addEventListener("error",a);if(t.includes(o.src)){n(e,o)}}return}if(document.body.matches("#group, #online, #members")&&e.matches(".aa.thumbs a")){const o=e.querySelector("img");if(o){o.addEventListener("error",a);if(t.includes(o.src)){n(e,o)}}return}if(e.matches("dl.profile-friends.thumbs dd.Sub.Item a")){const o=e.querySelector("img");if(o){o.addEventListener("error",a);if(t.includes(o.src)){n(e,o)}}return}}function m(){const e=new MutationObserver((e=>{e.forEach((e=>{Array.from(e.addedNodes).forEach((e=>{if(e.nodeType===1){if(e.matches(".menuwrap .avatar, .menuwrap .avatar *")){const t=e.matches("img")?e:e.querySelector("img");if(t){l(t)}return}if(document.body.matches("#topic")&&e.matches("#markdiv .list-users div, #markdiv .list-users div *")){const t=e.closest("#markdiv .list-users div")||e;if(t.matches("div")){l(t)}const o=t.querySelector("img");if(o){if(o.complete&&o.naturalWidth===0){l(o)}else{o.addEventListener("error",a)}}}else if(document.body.matches("#topic")&&e.matches(".atwho-view-ul, .atwho-view-ul *, .atwho-view-ul li, .atwho-view-ul li *")){const t=e.closest("li")||e;if(t.matches("li")){l(t)}const o=t.querySelector("img");if(o)l(o)}else if(document.body.matches("#topic")&&e.matches("ul.ve-dropdown-list.ve-mention-list, ul.ve-dropdown-list.ve-mention-list *, ul.ve-dropdown-list.ve-mention-list li, ul.ve-dropdown-list.ve-mention-list li *")){const t=e.closest("li")||e;if(t.matches("li")){l(t)}const o=t.querySelector(".ve-mention-image img");if(o)l(o)}else if(document.body.matches("#topic, #blog")&&e.matches(".post .left, .post .left *")){l(e)}else if(document.body.matches("#blog")&&e.matches("#centerdiv .title2.top.Item.Justify span.avatar.thumbs, #centerdiv .title2.top.Item.Justify span.avatar.thumbs *")){const t=e.closest("span.avatar.thumbs")||e;l(t)}else if(e.matches(".st-emoji-notice-item, .st-emoji-notice-item *")){const t=e.closest(".st-emoji-notice-item")||e;if(t.matches(".st-emoji-notice-item")){l(t)}const o=t.querySelector(".st-emoji-notice-avatar img");if(o)l(o)}else if(e.matches(".st-emoji-user-list, .st-emoji-user-list *, .st-emoji-user, .st-emoji-user *")){const t=e.closest(".st-emoji-user")||e;if(t.matches(".st-emoji-user")){l(t)}const o=t.querySelector(".st-emoji-user-avatar img");if(o)l(o)}else if(e.matches(".notification-container, .notification-container *")){const t=e.matches(".notification-container")?e:e.closest(".notification-container");if(t)l(t)}else if(document.body.matches("#profile")&&e.matches("#pop_profile .thumbs a, #pop_profile .thumbs a *")){const t=e.matches("#pop_profile .thumbs a")?e:e.closest("#pop_profile .thumbs a");if(t)l(t)}else if(document.body.matches("#group, #online, #members")&&e.matches(".aa.thumbs a, .aa.thumbs a *")){const t=e.matches(".aa.thumbs a")?e:e.closest(".aa.thumbs a");if(t)l(t)}else if(e.matches("dl.profile-friends.thumbs dd.Sub.Item, dl.profile-friends.thumbs dd.Sub.Item *")){const t=e.matches("dd.Sub.Item")?[e]:e.closest("dd.Sub.Item");if(t)l(t)}else if(e.matches(".st-emoji-notice-avatar, .profile .avatar")){l(e)}const t=[".menuwrap .avatar",".st-emoji-notice-item",".st-emoji-user-list",".st-emoji-user",".st-emoji-user-avatar",".notification-container",".profile .avatar","dl.profile-friends.thumbs dd.Sub.Item"];if(document.body.matches("#topic")){t.push("#markdiv .list-users div");t.push("ul.ve-dropdown-list.ve-mention-list li");t.push(".atwho-view-ul li");t.push(".post .left")}if(document.body.matches("#blog")){t.push(".post .left");t.push("#centerdiv .title2.top.Item.Justify span.avatar.thumbs")}if(document.body.matches("#group, #online, #members")){t.push(".aa.thumbs a")}if(document.body.matches("#profile")){t.push("#pop_profile .thumbs a")}e.querySelectorAll(t.join(", ")).forEach((e=>{l(e)}))}}));const t=[".menuwrap .avatar img","dl.profile-friends.thumbs dd.Sub.Item a img",".aa.thumbs a img","#pop_profile .thumbs a img",".post .left a img",".st-emoji-user-avatar img",".notification-image .avatar img",".ve-mention-image img",".atwho-view-ul li img","#centerdiv .title2.top.Item.Justify span.avatar.thumbs img",".st-emoji-notice-avatar img","#markdiv .list-users div img"].filter((e=>{if(e===".aa.thumbs a img"){return document.body.matches("#group, #online, #members")}if(e==="#pop_profile .thumbs a img"){return document.body.matches("#profile")}if(e===".ve-mention-image img"||e===".atwho-view-ul li img"){return document.body.matches("#topic")}if(e===".post .left a img"||e==="#centerdiv .title2.top.Item.Justify span.avatar.thumbs img"){return document.body.matches("#topic, #blog")}if(e==="#markdiv .list-users div img"){return document.body.matches("#topic")}return true})).join(", ");if(e.type==="attributes"&&e.target.matches(t)){l(e.target)}}))}));e.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:["src"]});function t(){const e=[".menuwrap .avatar",".st-emoji-notice-item",".st-emoji-user-list",".st-emoji-user",".st-emoji-user-avatar",".notification-container",".profile .avatar","dl.profile-friends.thumbs dd.Sub.Item a","#markdiv .list-users div"];if(document.body.matches("#topic")){e.push("ul.ve-dropdown-list.ve-mention-list li");e.push(".atwho-view-ul li");e.push(".post .left")}if(document.body.matches("#blog")){e.push("#centerdiv .title2.top.Item.Justify span.avatar.thumbs")}if(document.body.matches("#group, #online, #members")){e.push(".aa.thumbs a")}if(document.body.matches("#profile")){e.push("#pop_profile .thumbs a")}document.querySelectorAll(e.join(", ")).forEach(l);const t=(e,t)=>{const o=document.querySelector(e);if(o){const e=new MutationObserver(t);e.observe(o,{childList:true,subtree:true})}};if(document.body.matches("#topic")){t("#markdiv .list-users",(()=>{document.querySelectorAll("#markdiv .list-users div").forEach(l)}))}if(document.body.matches("#blog")){t("#centerdiv .title2.top.Item.Justify",(()=>{document.querySelectorAll("#centerdiv .title2.top.Item.Justify span.avatar.thumbs").forEach(l)}))}t("dl.profile-friends.thumbs",(()=>{document.querySelectorAll("dl.profile-friends.thumbs dd.Sub.Item a").forEach(l)}));if(document.body.matches("#group, #online, #members")){t(".aa.thumbs",(()=>{document.querySelectorAll(".aa.thumbs a").forEach(l)}))}if(document.body.matches("#profile")){t("#pop_profile .thumbs",(()=>{document.querySelectorAll("#pop_profile .thumbs a").forEach(l)}))}t(".st-emoji-user-list",(()=>{document.querySelectorAll(".st-emoji-user").forEach(l);document.querySelectorAll(".st-emoji-user-avatar img").forEach(l)}));t(".notification-container",(()=>{document.querySelectorAll(".notification-container").forEach(l)}));if(document.body.matches("#topic")){t("ul.ve-dropdown-list.ve-mention-list",(()=>{document.querySelectorAll("ul.ve-dropdown-list.ve-mention-list li").forEach(l)}))}if(document.body.matches("#topic")){t(".atwho-view-ul",(()=>{document.querySelectorAll(".atwho-view-ul li").forEach(l)}))}t(".st-emoji-notice-item",(()=>{document.querySelectorAll(".st-emoji-notice-item").forEach(l)}))}t();let o=0;const i=setInterval((()=>{t();o++;if(o>=5)clearInterval(i)}),500)}m()}();
//Emojione 
function processEmojisInColorClass(){const e=[];document.querySelectorAll(".post .color,#loading .color,.summary .color,.st-emoji-epost-content.color,#notifications-modal .notification-text,.st-emoji-post-item .color").forEach(t=>{t.dataset.emojiProcessed||e.push(t)}),e.length>0&&requestIdleCallback(()=>{e.forEach(e=>{const t=e.innerHTML,o=emojione.toImage(t);o!==t&&(e.innerHTML=o),e.dataset.emojiProcessed="true"})},{timeout:1e3})}processEmojisInColorClass();const emojiObserver=new MutationObserver(e=>{let t=!1,o=new Set;e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches(".post .color,#loading .color,.summary .color,.st-emoji-epost-content.color,#notifications-modal .notification-text,.st-emoji-post-item .color")&&!e.dataset.emojiProcessed&&(o.add(e),t=!0),e.querySelectorAll&&e.querySelectorAll(".post .color,#loading .color,.summary .color,.st-emoji-epost-content.color,#notifications-modal .notification-text,.st-emoji-post-item .color").forEach(e=>{e.dataset.emojiProcessed||(o.add(e),t=!0)}))})}),t&&requestIdleCallback(()=>{o.forEach(e=>{const t=e.innerHTML,o=emojione.toImage(t);o!==t&&(e.innerHTML=o),e.dataset.emojiProcessed="true"})},{timeout:2e3})});emojiObserver.observe(document.body,{childList:!0,subtree:!0});
//Favicons 
function updateFaviconsForLinks(e){const t=[];e.forEach(e=>{e.dataset.faviconProcessed||e.closest(".spoiler .code_top a")||e.closest(".fancyborder a")||e.closest(".quote_top a")||e.closest(".ve-content [data-type=mention]")||e.querySelector("img")||e.matches(".color div[align='center'] a")&&e.hasAttribute("data-readmore-toggle")||t.push(e)}),t.length>0&&requestIdleCallback(()=>{t.forEach(e=>{const t=e.href.includes("youtu.be")?"youtube.com":new URL(e.href).hostname,o=`https://www.google.com/s2/favicons?domain=${t}`;e.style.backgroundImage=`url('${o}')`,e.style.backgroundSize=e.matches(".quote a,.tmsg a")?"14px 14px":"16px 16px",e.style.backgroundPosition="left center",e.style.backgroundRepeat="no-repeat",e.style.paddingLeft=e.matches(".quote a,.tmsg a")?"17px":"19px",e.dataset.faviconProcessed="true"})},{timeout:1e3})}updateFaviconsForLinks(document.querySelectorAll(".post .color a,.summary .color a,#loading .color a,#search .color a,span.tmsg a,.st-emoji-post-item .color a"));const faviconObserver=new MutationObserver(e=>{const t=new Set;e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches(".post .color a,.summary .color a,#loading .color a,#search .color a,span.tmsg a,.st-emoji-post-item .color a")&&!e.dataset.faviconProcessed&&t.add(e),e.querySelectorAll&&e.querySelectorAll(".post .color a,.summary .color a,#loading .color a,#search .color a,span.tmsg a,.st-emoji-post-item .color a").forEach(e=>{e.dataset.faviconProcessed||t.add(e)}))})}),t.size>0&&requestIdleCallback(()=>{updateFaviconsForLinks(Array.from(t))},{timeout:2e3})});faviconObserver.observe(document.body,{childList:!0,subtree:!0});
//Light gallery 
function initColorLightGallery(){if(typeof lightGallery==="undefined"){setTimeout(initColorLightGallery,100);return}const t=["topic","send","blog","search"];const e=document.body.id;if(!t.includes(e)){return}const r=document.querySelectorAll(".color");if(r.length===0){return}r.forEach((function(t){const e=t.querySelectorAll('img[src]:not(.emojione):not(.signature img):not([src^="https://img.forumfree.net/html/emoticons/new"]):not([src^="https://img.forumfree.net/html/mime_types"])');if(e.length===0){return}let r=false;e.forEach((function(t,e){if(t.alt&&t.alt.startsWith(":")){return}if(t.parentNode.tagName.toLowerCase()==="a"&&t.src.startsWith("https://www.google.com/s2/favicons")){return}if(t.parentNode.tagName.toLowerCase()==="a"&&t.parentNode.href!==t.src){return}t.setAttribute("data-src",t.src);t.setAttribute("data-thumb",t.src);if(t.naturalWidth&&t.naturalHeight){t.setAttribute("data-lg-size",t.naturalWidth+"-"+t.naturalHeight)}else{const e=new Image;e.onload=function(){t.setAttribute("data-lg-size",e.naturalWidth+"-"+e.naturalHeight)};e.onerror=function(){const e=t.getAttribute("width")||"1920";const r=t.getAttribute("height")||"1080";t.setAttribute("data-lg-size",e+"-"+r)};e.src=t.src}r=true}));if(r){try{lightGallery(t,{selector:"img[data-src]",plugins:[lgZoom,lgThumbnail,lgFullscreen,lgAutoplay,lgShare],speed:300,download:true,counter:true,enableDrag:true,enableSwipe:true,hash:false,autoplay:true,autoplayControls:true,thumbnail:true,animateThumb:true,showThumbByDefault:true,toggleThumb:true,exThumbImage:"data-thumb",hideBarsDelay:2e3,hideControlOnEnd:false,addClass:"lg-custom",dynamic:false,debug:false,closable:true,closeOnTap:true,closeOnSwipe:true,loop:false})}catch(t){}}}))}function waitForLightGallery(){if(typeof lightGallery!=="undefined"&&typeof lgZoom!=="undefined"&&typeof lgThumbnail!=="undefined"&&typeof lgFullscreen!=="undefined"&&typeof lgAutoplay!=="undefined"&&typeof lgShare!=="undefined"){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initColorLightGallery)}else{setTimeout(initColorLightGallery,500)}}else{setTimeout(waitForLightGallery,100)}}waitForLightGallery();
//Slick carousel 
$('.slick_carousel').slick({slidesToShow:1,slidesToScroll:1,autoplay:true,autoplaySpeed:3820,dots:true,infinite:true,centerMode:true,lazyLoad:'ondemand',pauseOnFocus:false});
//Reply counter 
!function(){function e(){const e=document.querySelectorAll(".post"),t=+(new URLSearchParams(location.search).get("st")||0)+1;e.forEach((e,o)=>{if(e.querySelector(".reply_counter"))return;const r=document.createElement("b");r.className="reply_counter",r.textContent="#"+(t+o);const s=e.querySelector(".mini_buttons.rt.Sub");s&&s.appendChild(r)})}e();new MutationObserver(t=>{t.some(t=>Array.from(t.addedNodes).some(t=>1===t.nodeType&&t.matches(".post")))&&e()}).observe(document.body,{childList:!0,subtree:!0})}();
//Goto
!function(){let e;function t(t){scrollTo({top:t,behavior:"smooth"})}function o(t){t.classList.add("active"),t.style.zIndex="9999"}function n(t){t.classList.remove("active")}function i(){document.querySelector(".p_up").onclick=()=>t(0),document.querySelector(".p_down").onclick=()=>t(document.body.scrollHeight);const i=document.querySelector(".goto");onscroll=()=>{clearTimeout(e),o(i),e=setTimeout(()=>n(i),3e3)},i.onmouseenter=()=>{clearTimeout(e),o(i)},i.onmouseleave=()=>{e=setTimeout(()=>n(i),3e3)}}i();new MutationObserver(t=>{t.some(t=>Array.from(t.addedNodes).some(t=>1===t.nodeType&&t.matches(".p_up, .p_down, .goto")))&&i()}).observe(document.body,{childList:!0,subtree:!0})}();
//Fast send buttons
function initEditorEnhancements(){const e=document.createElement("select");e.title="Insert Font Size tags";e.className="codebuttons";e.setAttribute("onchange","tag('[size='+this.options[this.selectedIndex].value+']','[/size]'); this.selectedIndex=0");const t=[{value:"0",text:"SIZE"},{value:"2",text:"Very Small"},{value:"3.5",text:"Small"},{value:"5",text:"Regular"},{value:"8",text:"Large"},{value:"12.5",text:"Extra Large"}];t.forEach((t=>{const n=document.createElement("option");n.value=t.value;n.textContent=t.text;e.appendChild(n)}));const n=document.createElement("select");n.title="Insert Font Face tags";n.className="codebuttons";n.setAttribute("onchange","tag('[font='+this.options[this.selectedIndex].value+']','[/font]'); this.selectedIndex=0");const s=[{value:"0",text:"FONT"},{value:"Arial",text:"Arial"},{value:"Times",text:"Times"},{value:"Courier",text:"Courier"},{value:"Impact",text:"Impact"},{value:"Geneva",text:"Geneva"},{value:"Optima",text:"Optima"},{value:"Bree Serif",text:"Bree Serif"},{value:"Quicksand",text:"Quicksand"}];s.forEach((e=>{const t=document.createElement("option");t.value=e.value;t.textContent=e.text;n.appendChild(t)}));const o=`<button type="button" accesskey="s" title="Insert Strikethrough Text (alt + s)" onclick="tag('<del>','</del>')" class="codebuttons"><del>&nbsp;S&nbsp;</del></button><button type="button" accesskey="a" title="Insert superscript (alt + a)" onclick="tag('<sup>','</sup>')" class="codebuttons">&nbsp;x²<span style="font-size:6px">&nbsp;</span></button><button type="button" accesskey="p" title="Insert subscript (alt + p)" onclick="tag('<sub>','</sub>')" class="codebuttons">&nbsp;x<span style="position:relative;top:0.5em">²</span><span style="font-size:6px">&nbsp;</span></button><button type="button" accesskey="l" title="Create a list (alt + l)" onclick="tag_list()" class="codebuttons"><img src="https://img.forumfree.net/index_file/bb_ol.gif" style="width:22px;height:14px" alt=""></button>`;function a(s){const a=s.querySelector('.fast.send select[title="Insert Font Color tags"]');if(a&&!s.querySelector('select[title="Insert Font Size tags"]')){a.parentNode.insertBefore(e.cloneNode(true),a)}const c=s.querySelector('#send .send select[title="Insert Font Size tags"]');if(c){c.innerHTML="";t.forEach((e=>{const t=document.createElement("option");t.value=e.value;t.textContent=e.text;c.appendChild(t)}))}const l=s.querySelector('.fast.send button[title="Insert Underlined Text (alt + u)"]');if(l&&!s.querySelector('button[accesskey="s"]')){l.insertAdjacentHTML("afterend",o)}const i=s.querySelector('.fast.send input[type="button"][accesskey="t"][value="@Tag"]');if(i&&!s.querySelector('select[title="Insert Font Face tags"]')){i.insertAdjacentElement("afterend",n.cloneNode(true))}s.querySelectorAll('select.codebuttons[onchange^="tag(\'[font="]').forEach((e=>{if(!e.querySelector('option[value="Bree Serif"]')){const t=document.createElement("option");t.value="Bree Serif";t.textContent="Bree Serif";e.appendChild(t)}if(!e.querySelector('option[value="Quicksand"]')){const t=document.createElement("option");t.value="Quicksand";t.textContent="Quicksand";e.appendChild(t)}}))}const c=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{if(e.nodeType===1){if(e.matches&&(e.matches("#topic .send, #send .send")||e.querySelector("#topic .send, #send .send"))){const t=e.matches("#topic .send, #send .send")?[e]:e.querySelectorAll("#topic .send, #send .send");t.forEach(a)}if(e.tagName==="SELECT"&&e.classList.contains("codebuttons")&&e.getAttribute("onchange")?.startsWith("tag('[font=")){if(!e.querySelector('option[value="Bree Serif"]')){const t=document.createElement("option");t.value="Bree Serif";t.textContent="Bree Serif";e.appendChild(t)}if(!e.querySelector('option[value="Quicksand"]')){const t=document.createElement("option");t.value="Quicksand";t.textContent="Quicksand";e.appendChild(t)}}}}))}))}));document.querySelectorAll("#topic .send, #send .send").forEach(a);c.observe(document.body,{childList:true,subtree:true})}initEditorEnhancements();
//Youtube lite
function replaceYouTubeIframes(){const e=document.querySelectorAll('.post .color iframe');e.forEach(e=>{const t=e.src;if(t&&(t.includes('youtube.com/embed/')||t.includes('youtube-nocookie.com/embed/'))){const n=t.split('/embed/')[1].split('?')[0];e.setAttribute('data-lite-src',t),e.removeAttribute('src');const o=document.createElement('lite-youtube');o.setAttribute('videoid',n),e.replaceWith(o)}})}replaceYouTubeIframes();
//Quote
function isInsideVeContentColor(e){return null!==e.closest(".ve-content.color")}function expandQuotes(e){if(!isInsideVeContentColor(e)&&!e.querySelector(".quotebtn")&&!e.dataset.quoteProcessed){let t=!1;const o=e.querySelectorAll("img, iframe");if(o.length>0){const n=Array.from(o).some(e=>{const t=parseInt(e.getAttribute("height")),o=parseInt(e.getAttribute("width"));return!isNaN(t)&&t>200||!isNaN(o)&&o>300});n&&(t=!0)}if(e.scrollHeight>170||t){e.style.height="170px",e.style.maxHeight="none",e.style.overflow="hidden";const o=document.createElement("div");o.className="quotebtn";const n=document.createElement("button");n.innerHTML="Show More...",n.type="button",o.appendChild(n),e.appendChild(o)}else if(e.querySelector(".spoiler")){e.style.maxHeight="none"}e.dataset.quoteProcessed="true"}}function modifyQuoteTop(e){if(isInsideVeContentColor(e)||e.dataset.quoteTopProcessed)return;const t=e.textContent,o=e.querySelector("a");if(t.includes("@")){const n=t.replace(/(.*)\s*\(([^@]+)@[^)]+\)\s*/,"$2 said:");e.innerHTML=n,e.style.color="var(--mdcol)",o&&(e.appendChild(o),o.style.color="var(--mdcol)")}else{const t=e.querySelector(".quote_top b");t&&(t.style.opacity=1)}e.dataset.quoteTopProcessed="true"}function animateHeight(e,t,o){const n=e.clientHeight,c=performance.now();requestAnimationFrame((function animate(i){const r=i-c,u=Math.min(r/o,1);e.style.height=n+(t-n)*u+"px",u<1?requestAnimationFrame(animate):(e.style.height="auto",e.style.overflow="visible")}))}function processLoadingQuotes(){const e=document.querySelector("#loading");if(e){const t=e.querySelectorAll(".quote:not([data-quote-processed])"),o=e.querySelectorAll(".quote_top:not([data-quote-top-processed])");t.forEach(expandQuotes),o.forEach(modifyQuoteTop)}}function processStEmojiQuotes(){const e=document.querySelectorAll(".st-emoji-post-content");let t=0,o=0;e.forEach(((e,n)=>{const s=e.querySelectorAll(".quote:not([data-quote-processed])"),c=e.querySelectorAll(".quote_top:not([data-quote-top-processed])");s.forEach((e=>{let n=!1;const c=e.querySelectorAll("img, iframe");if(c.length>0){const s=Array.from(c).some(e=>{const t=parseInt(e.getAttribute("height")),o=parseInt(e.getAttribute("width"));return!isNaN(t)&&t>200||!isNaN(o)&&o>300});s&&(n=!0)}if(!e.querySelector(".quotebtn")&&(e.scrollHeight>170||n)){e.style.height="170px",e.style.maxHeight="none",e.style.overflow="hidden";const o=document.createElement("div");o.className="quotebtn";const s=document.createElement("button");s.innerHTML="Show More...",s.type="button",o.appendChild(s),e.appendChild(o),e.dataset.quoteProcessed="true",t++}})),c.forEach((e=>{const t=e.textContent,s=e.querySelector("a");t.includes("@")?(e.innerHTML=t.replace(/(.*)\s*\(([^@]+)@[^)]+\)\s*/,"$2 said:"),e.style.color="var(--mdcol)",s&&(e.appendChild(s),s.style.color="var(--mdcol)")):(n=e.querySelector(".quote_top b"))&&(n.style.opacity="1"),e.dataset.quoteTopProcessed="true",o++}))}))}if(document.body.matches("#topic, #send, #blog, #search")){let e,t=!1;const o=()=>{t||(t=!0,[document.querySelector("#topic .posts, #send .summary, #blog .posts, #search .posts"),document.querySelector("#loading"),document.querySelector(".st-emoji-post-content")].filter(Boolean).forEach(e=>{n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["src"]})}))};document.body.addEventListener("click",(c=>{c.target.matches(".quotebtn button")&&requestIdleCallback(()=>{const i=c.target.closest(".quote");animateHeight(i,i.scrollHeight,382),setTimeout((()=>{c.target.parentElement.remove()}),0)})})),document.querySelectorAll(".post .color .quote, .summary li .quote, #loading .quote, .st-emoji-post-content .color .quote").forEach(expandQuotes),document.querySelectorAll(".post .color .quote_top, .summary li .quote_top, #loading .quote_top, .st-emoji-post-content .color .quote_top").forEach(modifyQuoteTop),processStEmojiQuotes(),processLoadingQuotes();const n=new MutationObserver(c=>{let s=!1,i=!1,r=!1;c.forEach(c=>{"childList"===c.type&&c.addedNodes.forEach(c=>{if(c.nodeType===Node.ELEMENT_NODE){c.matches(".st-emoji-post-content")||c.querySelector(".st-emoji-post-content")&&(s=!0);const e=c.closest("#loading");e&&(r=!0);const o=c.closest(".post, .summary li, #loading, .st-emoji-post-content");o&&(c.matches(".quote")&&!c.dataset.quoteProcessed||c.matches(".quote_top")&&!c.dataset.quoteTopProcessed||c.querySelectorAll(".quote:not([data-quote-processed]), .quote_top:not([data-quote-top-processed])").length>0)&&(i=!0)}})}),(s||i||r)&&(clearTimeout(e),e=setTimeout(()=>{requestIdleCallback(()=>{s&&processStEmojiQuotes();r&&processLoadingQuotes();if(i){const e=new Set,c=new Set;c.forEach(c=>{"childList"===c.type&&c.addedNodes.forEach(c=>{if(c.nodeType===Node.ELEMENT_NODE){const s=c.closest(".post, .summary li, #loading, .st-emoji-post-content");s&&(c.matches(".quote")&&!c.dataset.quoteProcessed?e.add(c):c.matches(".quote_top")&&!c.dataset.quoteTopProcessed&&c.add(c),c.querySelectorAll&&(c.querySelectorAll(".quote:not([data-quote-processed])").forEach(s=>{const i=s.closest(".post, .summary li, #loading, .st-emoji-post-content");i&&e.add(s)}),c.querySelectorAll(".quote_top:not([data-quote-top-processed])").forEach(s=>{const e=s.closest(".post, .summary li, #loading, .st-emoji-post-content");e&&c.add(s)})))}}),"attributes"===c.type&&c.target.matches(".quote:not([data-quote-processed])")&&!c.target.querySelector(".quotebtn")&&c.target.closest(".post, .summary li, #loading, .st-emoji-post-content")&&e.add(c.target)}),e.forEach(expandQuotes),c.forEach(modifyQuoteTop)}},{timeout:50})},10))});o(),n.observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("beforeunload",(()=>{n.disconnect()}))};
//Skin
const root=document.documentElement,button=document.getElementById("theme-toggle-button");button.addEventListener("click",(()=>{"second"===root.getAttribute("data-theme")?(root.removeAttribute("data-theme"),localStorage.removeItem(storageKey)):(root.setAttribute("data-theme","second"),localStorage.setItem(storageKey,"second"))}));
//Image generator 
function createCustomDialog(){let e=document.querySelector(".imgen"),t=document.querySelector(".imgen-backdrop"),n=document.querySelector(".imgen-alert");if(e)e.style.display="block",t.style.display="block",n.style.display="none",e.querySelector("input")?.focus();else{e=document.createElement("div"),e.className="imgen",e.style.zIndex=9999;t=document.createElement("div"),t.className="imgen-backdrop",t.onclick=()=>{e.style.display="none",t.style.display="none",n.style.display="none",l.value=""};n=document.createElement("div"),n.className="imgen-alert",n.innerHTML='<i class="fa-regular fa-circle-exclamation"></i> Please enter a valid URL',n.style.display="none";const a=document.createElement("div");a.className="header",a.innerHTML='<i class="fa-regular fa-image"></i> Generate Image Thumbnail',e.appendChild(a),e.appendChild(n);const l=document.createElement("input");l.type="text",l.placeholder="Insert image link...",l.setAttribute("aria-label","Image URL"),l.onclick=()=>l.select(),e.appendChild(l);const c=document.createElement("button");c.className="codebuttons",c.textContent="INSERT",c.setAttribute("aria-label","Insert"),c.onclick=()=>{const t=l.value;validateImageURL(t,(n=>{n?(tag('<img src="'+t+'">',""),triggerInputEvent(),e.style.display="none",t.style.display="none",l.value=""):(n.style.display="block")}))},e.appendChild(c),document.body.appendChild(t),document.body.appendChild(e),e.style.display="block",l.focus()}}function triggerInputEvent(){document.querySelector("textarea#Post")?.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}function validateImageURL(e,t){clearTimeout(validateImageURL._t),validateImageURL._t=setTimeout(()=>{const n=new Image;n.src=e,n.onload=()=>t(!0),n.onerror=()=>t(!1)},300)}function tag_image(){createCustomDialog()}!document.URL.includes("?act=Post")&&!document.URL.includes("?t=")&&document.querySelector('.codebuttons[value*="IMG"]')?.addEventListener("click",tag_image);
//Link generator
let linkgenInput;function createCustomLinkDialog(){const e=document.querySelector(".linkgen"),n=document.querySelector(".linkgen-backdrop"),t=document.querySelector(".linkgen-alert");if(e)e.style.display="block",n.style.display="block",t.style.display="none",linkgenInput.value="",linkgenInput.focus();else{const e=document.createElement("div");e.className="linkgen",e.style.zIndex=9999;const n=document.createElement("div");n.className="header",n.innerHTML='<i class="fa-regular fa-link"></i> Generate Link',e.appendChild(n);const t=document.createElement("div");t.className="linkgen-alert",t.innerHTML='<i class="fa-regular fa-circle-exclamation"></i> Please enter a valid URL',t.style.display="none";const l=document.createElement("div");l.className="linkgen-backdrop",l.addEventListener("click",(function(){e.style.display="none",l.style.display="none",linkgenInput.value="",a.value="",t.style.display="none"})),linkgenInput=document.createElement("input"),linkgenInput.type="text",linkgenInput.placeholder="Insert link...",linkgenInput.setAttribute("aria-label","URL"),linkgenInput.addEventListener("click",(function(){linkgenInput.value&&linkgenInput.select()}));const a=document.createElement("input");a.type="text",a.placeholder="Custom text...",a.setAttribute("aria-label","Custom Text");const i=document.createElement("button");i.className="codebuttons",i.textContent="INSERT",i.addEventListener("click",(function(){const n=linkgenInput.value,i=a.value;if(isValidURL(n)&&!containsHTMLorBBCode(n)){let t="";t=i?'<a target="_blank" href="'+n+'">'+i+"</a>":'<a target="_blank" href="'+n+'">'+n+"</a>",tag(t,""),triggerInputEvent(),e.style.display="none",l.style.display="none",linkgenInput.value="",a.value=""}else t.style.display="block"})),e.appendChild(t),e.appendChild(linkgenInput),e.appendChild(a),e.appendChild(i),document.body.appendChild(e),document.body.appendChild(l),e.style.display="block",linkgenInput.focus()}}function triggerInputEvent(){const e=document.querySelector("textarea#Post");if(e){const n=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(n)}}function isValidURL(e){return/^https?:\/\/|^ftp:\/\//.test(e)}function containsHTMLorBBCode(e){return/<[^>]+>|\[.*?\]/.test(e)}const urlButton=document.querySelector('input[accesskey="w"]');urlButton&&(urlButton.removeAttribute("onclick"),urlButton.addEventListener("click",(function(){createCustomLinkDialog()})));
//Loading icon
function replaceElements(){const e='<i class="fa-regular fa-loader fa-spin"></i>';const n=[{sel:".emoji_loading",cond:e=>"&nbsp;"===e.innerHTML.trim(),action:n=>n.innerHTML=e},{sel:'img[src="https://img.forumfree.net/index_file/loads3.gif"]',action:e=>{const n=document.createElement("i");n.className="fa-regular fa-loader fa-spin",e.replaceWith(n)}},{sel:".st-emoji-spinner-border",action:e=>{const n=document.createElement("i");n.className="fa-regular fa-loader fa-spin",e.replaceWith(n)}},{sel:".st-emoji-loader div",action:e=>{const n=document.createElement("i");n.className="fa-regular fa-loader fa-spin",e.replaceWith(n)}}];n.forEach((({sel:e,cond:n,action:t})=>{document.querySelectorAll(e).forEach((e=>{if(!n||n(e))t(e)}))}));const t=document.getElementById("notifications-more");if(t&&!t.querySelector(".fa-spin")){const e=document.createElement("i");e.className="fa-regular fa-loader fa-spin",t.appendChild(e)}const o=document.querySelector('#popupmod #Cronmod img[src="https://img.forumfree.net/index_file/load.gif"]');if(o){const e=document.createElement("i");e.className="fa-regular fa-loader fa-spin",o.replaceWith(e)}}function waitForElement(e,n){const t=document.querySelector(e);if(t)return n(t),null;const o=new MutationObserver((t=>{const a=document.querySelector(e);a&&(o.disconnect(),n(a))}));o.observe(document.body,{childList:!0,subtree:!0})}replaceElements();const dynamicLoadingObserver=new MutationObserver((e=>{const n=e.some((e=>"childList"===e.type&&e.addedNodes.length>0));n&&replaceElements()}));dynamicLoadingObserver.observe(document.body,{childList:!0,subtree:!0});
//Preview 
const loadingElement=document.getElementById("loading");function handleLoadingElement(){if(!loadingElement)return;document.querySelectorAll(".send").forEach((e=>{const n=e.querySelectorAll("ul li.Item");if(n.length>=2){if(n[1]!==loadingElement.parentElement){n[1].appendChild(loadingElement)}}}))}const preview=new MutationObserver((e=>{for(const n of e){if(n.addedNodes.length>0&&n.target.querySelector(".send")){handleLoadingElement();break}}}));if(loadingElement){preview.observe(document.body,{childList:true,subtree:true});handleLoadingElement()}
//Attachment
const f=document.querySelector('body#send #attach input[name="FILE_UPLOAD"]');if(f){const e=document.createElement("div");e.id="attachments-preview",Object.assign(e.style,{marginTop:"12px",textAlign:"center",display:"flex",flexWrap:"wrap",gap:"8px"}),f.closest("td").appendChild(e);const t=10,o=10*1024*1024;f.addEventListener("change",(()=>{const r=document.createDocumentFragment(),c=Array.from(f.files||[]).slice(0,t);if(0===c.length){const t=document.createElement("p");t.textContent="No file selected.",e.innerHTML="",e.appendChild(t);return}let n=0;const i=c.length;c.forEach((t,a)=>{if(t.size>o){l(t,!1,r),d();return}t.type.startsWith("image/")?(u=new FileReader,u.onload=t=>{s(t.target.result,a,r),d()},u.onerror=()=>{l(a,!1,r),d()},u.readAsDataURL(t)):(l(t,!0,r),d())});function d(){n++,n===i&&(e.innerHTML="",e.appendChild(r))}function s(t,o,n){const i=document.createElement("img");i.src=t,i.alt=o.name,i.title=o.name,Object.assign(i.style,{maxWidth:"100px",maxHeight:"100px",borderRadius:"4px",objectFit:"cover"}),n.appendChild(i)}function l(t,o,n){const i=document.createElement("div");Object.assign(i.style,{display:"inline-block",textAlign:"center",margin:"0"});const d=document.createElement("i");d.className=o?"fa-regular fa-file-zipper":"fa-regular fa-file-exclamation",Object.assign(d.style,{fontSize:"66px",color:o?"var(--mdcol)":"#ff4444",margin:"10px"});const s=document.createElement("p");s.textContent=t.name.length>15?t.name.substring(0,12)+"...":t.name,Object.assign(s.style,{fontSize:".875rem",margin:"0",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis"}),i.appendChild(d),i.appendChild(s),n.appendChild(i)}var u}))}
//HTML colors
const colors=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","BlanchedAlmond","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkCyan","DarkGoldenRod","DarkGray","DarkKhaki","Darkorange","DarkSalmon","DarkSeaGreen","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DodgerBlue","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","GreenYellow","HoneyDew","HotPink","IndianRed","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","MediumAquaMarine","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MintCream","MistyRose","Moccasin","NavajoWhite","OldLace","Olive","OliveDrab","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","RosyBrown","RoyalBlue","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","WhiteSmoke","YellowGreen"];function populateColorDropdown(e){const l=document.createDocumentFragment();colors.forEach((function(o){const t=document.createElement("option");t.text=o,t.value=o,t.style.color=o,l.appendChild(t)})),e.appendChild(l)}const colorSelectors=[...document.querySelectorAll('.send select[title="Insert Font Color tags"]'),document.querySelector(".tag select.codebuttons")].filter((function(e){return e}));colorSelectors.forEach(populateColorDropdown);
//Timestamps
function initTimestampScript(){const t=Intl.DateTimeFormat().resolvedOptions().timeZone,e=document.body.classList.contains("guest");function i(e){const i=String(e).trim();if(i.includes("T")&&(i.includes("+")||i.includes("Z"))){const t=moment(i);if(t.isValid())return t}const r=["M/D/YYYY, h:mm A","M/D/YYYY, h:mm:ss A","D/M/YYYY, HH:mm","D/M/YYYY, HH:mm:ss","YYYY-MM-DD HH:mm:ss","YYYY-MM-DDTHH:mm:ss","YYYY/MM/DD HH:mm:ss","MMMM D, YYYY, h:mm A","MMM D, YYYY, h:mm A","YYYY-MM-DD","M/D/YYYY","D/M/YYYY"];for(const e of r){const r=moment(i,e,!0);if(r.isValid())return r}for(const e of r){const r=moment(i,e,!1);if(r.isValid())return r}const o=moment(i,moment.ISO_8601,!0);return o.isValid()?o:moment.invalid()}function r(t){if(!t||!t.isValid())return"Invalid date";var e=moment(),i=e.diff(t,"hours");return i<24?t.fromNow():i<48?"Yesterday at "+t.format("h:mm A"):i<168?t.format("dddd [at] h:mm A"):t.format("MMM D, YYYY")}function o(t){return!t||!t.isValid()?"Invalid date":t.format("MMM, YYYY")}function a(e,i){try{var r=moment.tz(e,i,"Europe/Rome");return r.isValid()?r.clone().tz(t):null}catch(t){return null}}function n(t){try{if(!t)return!1;const e=t.querySelector(".d_day"),i=t.querySelector(".d_month"),r=t.querySelector(".d_year");return e&&i&&r&&""===i.textContent.trim()&&""!==r.textContent.trim()&&!t.textContent.includes(":")}catch(t){return!1}}function m(t){try{const e=t.querySelector(".d_day"),i=t.querySelector(".d_year");if(!e||!i)return null;const r=parseInt(e.textContent.trim()),o=i.textContent.trim();if(isNaN(r)||!o)return null;const a=moment({year:o,month:r-1});return a.isValid()?a:null}catch(t){return null}}function l(t){try{if(t.classList.contains("timestamp-processed"))return;var e=t.getAttribute("datetime")||t.getAttribute("title")||t.textContent.trim(),o=i(e);if(o.isValid()){var a=document.createElement("time");a.className="u-dt",a.setAttribute("dir","auto"),a.setAttribute("datetime",o.format()),a.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),a.textContent=r(o),a.style.visibility="visible",a.classList.add("timestamp-processed"),t.replaceWith(a)}}catch(t){}}function c(t){try{var e=t.textContent.trim(),r=e.match(/^(Edited by .+?) - (.+)$/);if(r){var o=r[1],a=r[2],n=i(a);if(n.isValid()){var m=n.format("MMM D, YYYY");t.textContent=o+": "+m;var l=document.createElement("time");l.className="u-dt",l.setAttribute("datetime",n.format()),l.setAttribute("title",n.format("MMM D, YYYY [at] h:mm A")),l.textContent=m,t.innerHTML=o+": ",t.appendChild(l),t.style.visibility="visible"}}}catch(t){}}function s(t){try{var e=t.querySelector(".when");if(!e)return;var r=e.textContent.trim(),o=i(r);if(!o.isValid())return;var a=document.createElement("time");a.className="u-dt",a.setAttribute("datetime",o.format()),a.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),a.textContent=o.format("MMM D, YYYY"),a.style.visibility="visible",e.replaceWith(a)}catch(t){}}function u(t){try{if(!document.body.matches("#online"))return;var e=t.textContent.trim(),o=i(e);if(o.isValid()){var a=document.createElement("time");a.className="u-dt",a.classList.add("when"),a.setAttribute("dir","auto"),a.setAttribute("datetime",o.format()),a.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),a.textContent=r(o),a.style.visibility="visible",t.replaceWith(a)}}catch(t){}}function d(t){try{if(!document.body.matches("#blog"))return;if(n(t)){var e=m(t);if(e&&e.isValid()){var a=document.createElement("time");a.className="u-dt",a.classList.add("when"),a.setAttribute("dir","auto"),a.setAttribute("datetime",e.format()),a.setAttribute("title",e.format("MMM, YYYY")),a.textContent=o(e),a.style.visibility="visible",t.replaceWith(a);return}}var l=t.querySelector(".d_day")?t.querySelector(".d_day").textContent.trim():"",c=t.querySelector(".d_month")?t.querySelector(".d_month").textContent.trim():"",s=t.querySelector(".d_year")?t.querySelector(".d_year").textContent.trim():"";c=c.replace(/([A-Za-z]+).*/,"$1");var u=s+"-"+c+"-"+l,e=moment(u,"YYYY-MMM-DD",!0);e.isValid()||(e=i(u)),e.isValid()&&(a=document.createElement("time"),a.className="u-dt",a.classList.add("when"),a.setAttribute("dir","auto"),a.setAttribute("datetime",e.format()),a.setAttribute("title",e.format("MMM D, YYYY [at] h:mm A")),a.textContent=r(e),a.style.visibility="visible",t.replaceWith(a))}catch(t){}}function f(t){try{if(n(t)){var e=m(t);if(e&&e.isValid()){var a=document.createElement("time");a.className="u-dt",a.classList.add("when"),a.setAttribute("dir","auto"),a.setAttribute("datetime",e.format()),a.setAttribute("title",e.format("MMM, YYYY")),a.textContent=o(e),a.style.visibility="visible",t.replaceWith(a);return}}var l=t.querySelector(".d_day")?t.querySelector(".d_day").textContent.trim():"",c=t.querySelector(".d_month")?t.querySelector(".d_month").textContent.trim():"",s=t.querySelector(".d_year")?t.querySelector(".d_year").textContent.trim():"";c=c.replace(/([A-Za-z]+).*/,"$1");var u=s+"-"+c+"-"+l,e=moment(u,"YYYY-MMM-DD",!0);e.isValid()||(e=i(u)),e.isValid()&&(a=document.createElement("time"),a.className="u-dt",a.classList.add("when"),a.setAttribute("dir","auto"),a.setAttribute("datetime",e.format()),a.setAttribute("title",e.format("MMM D, YYYY [at] h:mm A")),a.textContent=r(e),a.style.visibility="visible",t.replaceWith(a))}catch(t){}}function Y(t){try{if(!document.body.matches("#group, #members"))return;var e=t.textContent.trim(),r=i(e);if(r.isValid()){var o=document.createElement("time");o.className="u-dt",o.classList.add("cc"),o.setAttribute("dir","auto"),o.setAttribute("datetime",r.format()),o.setAttribute("title",r.format("MMM D, YYYY")),o.textContent=r.format("MMM D, YYYY"),o.style.visibility="visible",t.replaceWith(o)}}catch(t){}}function h(t){try{if(!document.body.matches("#blog"))return;var e=t.getAttribute("title")||t.textContent.trim();e=e.split(":").slice(0,-1).join(":").trim();var o=i(e);if(o.isValid()){var a=document.createElement("time");a.className="u-dt",a.classList.add("when"),a.setAttribute("dir","auto"),a.setAttribute("datetime",o.format()),a.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),a.textContent=r(o),a.style.visibility="visible",t.replaceWith(a)}}catch(t){}}function y(t){try{if(t.classList.contains("timestamp-processed"))return;if(!document.body.matches("#board"))return;var e=t.lastChild;if(!e||e.nodeType!==Node.TEXT_NODE)return;var i=e.textContent.trim(),o=a(i,"D/M/YYYY, HH:mm");if(!o)return;var n=document.createElement("time");n.className="u-dt when",n.setAttribute("dir","auto"),n.setAttribute("datetime",o.format()),n.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),n.textContent=r(o),n.style.visibility="visible",n.classList.add("timestamp-processed"),t.replaceWith(n)}catch(t){}}function b(t){try{if(t.classList.contains("timestamp-processed"))return;var e=t.lastChild;if(!e||e.nodeType!==Node.TEXT_NODE)return;var i=e.textContent.trim(),o=a(i,"D/M/YYYY, HH:mm");if(!o)return;var n=document.createElement("time");n.className="u-dt when",n.setAttribute("dir","auto"),n.setAttribute("datetime",o.format()),n.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),n.textContent=r(o),n.style.visibility="visible",n.classList.add("timestamp-processed"),t.replaceWith(n)}catch(t){}}function M(t){try{var e=t.getAttribute("datetime")||t.textContent.trim();if(t.classList.contains("st-emoji-epost-time")){var i=moment(e,"YYYY/MM/DD HH:mm",!0);if(i&&i.isValid()){t.textContent=r(i),t.setAttribute("datetime",i.format()),t.setAttribute("title",i.format("MMM D, YYYY [at] h:mm A")),t.style.visibility="visible"}return}var o=a(e,"YYYY/MM/DD HH:mm");if(!o)return;t.textContent=r(o),t.setAttribute("datetime",o.format()),t.setAttribute("title",o.format("MMM D, YYYY [at] h:mm A")),t.style.visibility="visible"}catch(t){}}function v(t){try{var e=t.textContent.trim(),i=moment(e,"YYYY/MM/DD HH:mm",!0);if(i&&i.isValid()){var o=document.createElement("time");o.className="u-dt st-emoji-post-time",o.setAttribute("dir","auto"),o.setAttribute("datetime",i.format()),o.setAttribute("title",i.format("MMM D, YYYY [at] h:mm A")),o.textContent=r(i),o.style.visibility="visible",t.replaceWith(o)}}catch(t){}}function A(t,e){try{if(t.closest(".edit"))return;if(t.classList.contains("timeago"))return;if(".big_list .zz .when"===e&&!document.body.matches("#board, #forum, #blog, #search"))return;if(".post .title2.top .when"===e&&!document.body.matches("#topic, #search, #blog"))return;if(".summary .when"===e&&!document.body.matches("#send"))return;if(".article .title2.top .when"===e&&!document.body.matches("#blog"))return;var o=t.getAttribute("title")||t.textContent.trim();t.children.length&&"SPAN"===t.children[0].tagName&&(o=t.childNodes[t.childNodes.length-1].textContent.trim());var a=i(o);if(a.isValid()){if(t.classList.contains("st-emoji-notice-time")||t.classList.contains("st-emoji-epost-time"))M(t);else{var n=document.createElement("time");n.className="u-dt",t.classList.contains("when")&&n.classList.add("when"),t.classList.contains("Item")&&n.classList.add("Item"),n.setAttribute("dir","auto"),n.setAttribute("datetime",a.format()),n.setAttribute("title",a.format("MMM D, YYYY [at] h:mm A")),n.textContent=r(a),n.style.visibility="visible",n.classList.add("timestamp-processed"),t.replaceWith(n)}}}catch(t){}}function p(){try{document.querySelectorAll("dl.profile-joined, dl.profile-lastaction").forEach(s),document.querySelectorAll(".timeago").forEach(l),document.querySelectorAll(".post .edit").forEach(c),document.querySelectorAll(".st-emoji-post-time").forEach(v),document.body.matches("#online")&&document.querySelectorAll(".online .yy .when").forEach(u),document.body.matches("#blog")&&(document.querySelectorAll(".article .title2.top .when").forEach(d),document.querySelectorAll(".bt_mini .when").forEach(f),document.querySelectorAll(".mini_buttons .when").forEach(h)),document.body.matches("#group, #members")&&document.querySelectorAll(".big_list .cc").forEach(Y),document.body.matches("#board")&&document.querySelectorAll(".side_topics .when").forEach(y),document.querySelectorAll(".lastarticles .topic .when").forEach(b),document.querySelectorAll(".st-emoji-epost-time, .st-emoji-notice-time").forEach(M);var t=[".big_list .zz .when",".post-date",".time",".date",".post .title2.top .when",".summary .when"];for(var e=0;e<t.length;e++){var i=t[e];document.querySelectorAll(i).forEach((function(t){A(t,i)}))}}catch(t){}}p();var D=new MutationObserver((function(t){try{t.forEach((function(t){t.addedNodes.forEach((function(t){if(t.nodeType===1){if(t.classList&&t.classList.contains("timestamp-processed"))return;if(t.matches("dl.profile-joined, dl.profile-lastaction"))s(t);t.querySelectorAll("dl.profile-joined, dl.profile-lastaction").forEach(s),t.matches(".timeago")&&l(t),t.querySelectorAll(".timeago").forEach(l),t.matches(".post .edit")&&c(t),t.querySelectorAll(".post .edit").forEach(c),t.matches(".st-emoji-post-time")&&v(t),t.querySelectorAll(".st-emoji-post-time").forEach(v),document.body.matches("#online")&&t.matches(".online .yy .when")&&u(t),document.body.matches("#online")&&t.querySelectorAll(".online .yy .when").forEach(u),document.body.matches("#blog")&&t.matches(".article .title2.top .when")&&d(t),document.body.matches("#blog")&&t.matches(".bt_mini .when")&&f(t),document.body.matches("#blog")&&t.matches(".mini_buttons .when")&&h(t),document.body.matches("#blog")&&(t.querySelectorAll(".article .title2.top .when").forEach(d),t.querySelectorAll(".bt_mini .when").forEach(f),t.querySelectorAll(".mini_buttons .when").forEach(h)),document.body.matches("#group, #members")&&t.matches(".big_list .cc")&&Y(t),document.body.matches("#group, #members")&&t.querySelectorAll(".big_list .cc").forEach(Y),document.body.matches("#board")&&t.matches(".side_topics .when")&&y(t),document.body.matches("#board")&&t.querySelectorAll(".side_topics .when").forEach(y),t.matches(".lastarticles .topic .when")&&b(t),t.querySelectorAll(".lastarticles .topic .when").forEach(b),t.matches(".st-emoji-epost-time, .st-emoji-notice-time")&&M(t),t.querySelectorAll(".st-emoji-epost-time, .st-emoji-notice-time").forEach(M);var e=[".big_list .zz .when",".post-date",".time",".date",".post .title2.top .when",".summary .when"];for(var i=0;i<e.length;i++){var r=e[i];t.matches(r)&&A(t,r),t.querySelectorAll(r).forEach((function(t){A(t,r)}))}}}))}))}catch(t){}}));try{D.observe(document.body,{childList:!0,subtree:!0})}catch(t){}}function waitForMoment(){if("undefined"!=typeof moment&&"undefined"!=typeof moment.tz)initTimestampScript();else setTimeout(waitForMoment,50)}waitForMoment();
//Search reactions
!function(){if(!document.body.matches("#search"))return;function n(){document.querySelectorAll("#search .post").forEach(function(n){if(!n.querySelector(".reactions")){var e=n.querySelector(".points"),t=document.createElement("div");t.className="reactions";if(e){e.textContent.trim()||(e.innerHTML='<em class="points_pos">+0</em>'),t.appendChild(e),e.style.visibility="visible"}var o=n.querySelector(".post .center .Item table")||n.querySelector(".post .center .Item");o?o.parentNode.insertBefore(t,o.nextSibling):(o=n.querySelector(".post .center .Item"))&&o.appendChild(t)}})}n();var e=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){1===e.nodeType&&(e.matches(".post")||e.querySelector(".post"))&&n()})})});e.observe(document.body,{childList:!0,subtree:!0})}();
//Tooltips
function waitForElement(t,e,i=1e4){const o=Date.now(),checkForElement=()=>{const n=document.querySelectorAll(t);n.length>0?n.forEach(e):Date.now()-o<i&&requestAnimationFrame(checkForElement)};checkForElement()}function initTippy(t){t._tippy||tippy(t,{placement:"bottom",theme:"dark",animation:"fade",offset:[0,10],observe:!0,arrow:!1,onCreate(t){t.popper.classList.add("tippy-custom")}})}function addTooltip(t){waitForElement(t,(t=>{if(!t.hasAttribute("data-tippy-content")&&t.getAttribute("title")){const e=t.getAttribute("title");t.setAttribute("data-tippy-content",e),t.removeAttribute("title")}initTippy(t)}))}function setupReactionsTooltip(){const t=document.querySelector('.menu.st-emoji-notice a.st-emoji-link-void[data-toggle="emoji-notice-modal"]');if(t&&!t.closest('.menu.st-emoji-notice').querySelector('ul')&&!t.hasAttribute("data-tippy-content")&&!t.closest('.menu.st-emoji-notice').querySelector('em')){t.setAttribute("data-tippy-content","Reactions"),initTippy(t)}}const tooltipObserver=new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("data-tippy-content")&&initTippy(t)})),setupReactionsTooltip()}))}));document.body.classList.contains("mobile")||(tooltipObserver.observe(document.body,{childList:!0,subtree:!0}),waitForElement("body",(()=>{addTooltip(".st-editor-toggle"),waitForElement('button[name="full"]',(t=>{t.removeAttribute("title"),t.setAttribute("data-tippy-content","Full editor"),initTippy(t)})),addTooltip("#preview_button"),waitForElement('.top-button .topbutton input[type="submit"]',(t=>{const e=t.closest("form").querySelector('input[type="submit"]').value,i=t.closest(".top-button");i.setAttribute("data-tippy-content",e),initTippy(i)})),waitForElement("#mark-send button",(t=>{t.setAttribute("data-tippy-content","Find"),initTippy(t)})),waitForElement('.menuwrap a[href="#notifications"]',(t=>{t.setAttribute("data-tippy-content","Notifications"),initTippy(t)})),waitForElement(".navsub .lastpost a",(t=>{t.setAttribute("data-tippy-content","Go to first unread post"),initTippy(t)})),waitForElement(".navsub .last a",(t=>{t.setAttribute("data-tippy-content","Go to last page"),initTippy(t)})),waitForElement(".navsub .first a",(t=>{t.setAttribute("data-tippy-content","Go to first page"),initTippy(t)})),waitForElement('.big_list .zz input[type="checkbox"]',(t=>{t.setAttribute("data-tippy-content","Select topic"),initTippy(t)})),waitForElement('#send .send .darkbar button[name="preview"]',(t=>{t.setAttribute("data-tippy-content","Preview"),initTippy(t)})),waitForElement(".menuwrap .log",(t=>{t.setAttribute("data-tippy-content","Log in"),initTippy(t)})),waitForElement('.tag img[alt="x"]',(t=>{t.setAttribute("data-tippy-content","Delete"),t.removeAttribute("title"),initTippy(t)})),waitForElement("#topic .buttons a",(t=>{if(t.querySelector("span.reply")){t.removeAttribute("title"),t.setAttribute("data-tippy-content","Reply to this topic"),initTippy(t)}})),waitForElement("#topic .buttons a, #blog .buttons a",(t=>{if(t.querySelector("span.newpost")){t.removeAttribute("title"),t.setAttribute("data-tippy-content","Start a new topic"),initTippy(t)}})),addTooltip('.menuwrap a[href="#notifications"]'),addTooltip(".menuwrap .log"),addTooltip('#send .send .darkbar button[name="preview"]'),addTooltip(".navsub .lastpost a"),addTooltip(".navsub .last a"),addTooltip(".navsub .first a"),addTooltip('.big_list .zz input[type="checkbox"]'),addTooltip('#send .send .right.Sub img[alt="File Attachments"]'),addTooltip('.tag img[alt="x"]'),addTooltip('.post .title2.bottom .right.Item.Justify .rt.Sub input[type="checkbox"],.post .title2.bottom .right.Item.Justify .rt.Sub label'),addTooltip('#send .send button[name="preview"]'),addTooltip(".post .title2.top .right img.bullet_delete"),addTooltip('#send .send .right.Sub img[data-emojipicker="#Post"]');document.querySelectorAll("[data-tippy-content]").forEach((t=>{initTippy(t)})),setupReactionsTooltip()})));
//User tooltips
async function fetchUserDetails(e){try{const t=await fetch(e);if(!t.ok)throw new Error("Failed to fetch "+e);const o=await t.arrayBuffer(),a=new TextDecoder("windows-1252").decode(o),r=(new DOMParser).parseFromString(a,"text/html"),i=r.querySelector(".profile span.avatar")?r.querySelector(".profile span.avatar").innerHTML.replace(/<img/g,'<img decoding="async"'):"",l=r.querySelector(".profile span.nick")?r.querySelector(".profile span.nick").textContent:"Unknown User",s=r.querySelector(".profile-group dd.Sub.Item")?.textContent.trim()||"",n=r.querySelector(".profile-title dd.Sub.Item")?.textContent.trim()||"",p=r.querySelector(".profile-location dd.Sub.Item")?.textContent.trim()||"";function cleanNumberText(e){return e.replace(/^\+/,"").replace(/\s*\(.*?\)/g,"").trim()}function cleanDateText(e){return e.split(",")[0].trim()}const c=r.querySelector(".profile-joined")?{label:r.querySelector(".profile-joined dt")?.textContent.trim()||"Joined",value:cleanDateText(r.querySelector(".profile-joined dd")?.textContent||"")}:null,d=r.querySelector(".profile-posts")?{label:r.querySelector(".profile-posts dt")?.textContent.trim()||"Posts",value:cleanNumberText(r.querySelector(".profile-posts dd")?.textContent||"")}:null,u=r.querySelector(".profile-rep.u_reputation")?{label:r.querySelector(".profile-rep.u_reputation dt")?.textContent.trim()||"Reputation",value:cleanNumberText(r.querySelector(".profile-rep.u_reputation dd")?.textContent||"")}:null;return{avatar:i,nick:l,group:s,title:n,loc:p,joined:c,posts:d,rep:u,lastAction:r.querySelector(".profile-lastaction")?{label:r.querySelector(".profile-lastaction dt")?.textContent.trim()||"Last Action",value:cleanDateText(r.querySelector(".profile-lastaction dd")?.textContent||"")}:null}}catch(v){return console.error("Error fetching user details: "+v),null}}function initUserTooltips(){if(document.body.classList.contains("mobile"))return;async function checkImageStatus(e){return new Promise((t=>{if(!e)return t(!1);const o=new Image;o.onload=()=>t(!0),o.onerror=()=>t(!1),o.src=e}))}function e(e){const n=e.href||"https://perveavenue.forumcommunity.net/?act=Profile&MID="+e.className.replace("user","");tippy(e,{allowHTML:!0,placement:"bottom",theme:"dark",animation:"fade",offset:[0,10],arrow:!1,onShow:async function(t){e.dataset.tooltipLoaded||(t.popper.classList.add("hidden"),fetchUserDetails(n).then((async o=>{if(!o)return t.setContent('<div class="tooltip-error">Error loading user info</div>'),e.dataset.tooltipLoaded="true",t.popper.classList.remove("tippy-profile"),t.popper.classList.remove("hidden"),void t.popper.classList.add("tippy-profile-error");let a="",r="";o.group.toLowerCase().includes("global moderator")?(a="global-moderator",r="global-moderator"):o.group.toLowerCase().includes("administrator")?(a="administrator",r="administrator"):o.group.toLowerCase().includes("moderator")?(a="moderator",r="moderator"):o.group.toLowerCase().includes("game dev")?(a="game-dev",r="game-dev"):(a="utente",r="utente");const i=o.avatar;let l="";if(i){const e=["https://res.cloudinary.com/dbdf6gwgo/image/upload/v1674337715/forum/Avatar/default_avatar_zpw3zz.svg","https://res.cloudinary.com/dbdf6gwgo/image/upload/v1676109015/forum/Avatar/robot_snynw7.svg","https://img.forumfree.net/style_images/default_avatar.png","https://img.forumfree.net/style_images/default_avatar_bot.png"];const t=/(src=["'])([^"']*)/.exec(i);if(t&&t[2]){const n=t[2],c=e.some(e=>n.includes(e)),s=await checkImageStatus(n);if(c||!s){const e=o.nick.charAt(0).toUpperCase(),c=["#ff7770","#ff6b6b","#ff5154","#ffcb69","#fdc26d","#ffa96c","#ff9f1c","#ff8f5c","#9ce37d","#74c365","#16c172","#3ab795","#4ecdc4","#2dc7ff","#0eb1d2","#009bf5","#a3bcf9","#9b9ece","#9792e3","#8075ff","#b455b0","#a755c2","#a5acb5","#889696"],a=Math.min(Math.floor(o.nick.length/Math.ceil(1/c.length)),c.length-1);l='<span class="avatar" style="background-color:'+c[a]+'">'+e+"</span>"}else{l=i}}else{l=i}}const s=l||i;return t.setContent('<div class="tooltip-user-details"><div class="tippy-details"><div class="tooltip-avatar">'+s+'</div><div class="tippy-info"><div class="tippy-nick '+r+'">'+o.nick+"</div>"+(o.group?'<div class="tippy-group '+a+'">'+o.group+"</div>":"")+(o.title?'<div class="tippy-title">'+o.title+"</div>":"")+(o.loc?'<div class="tippy-location">'+o.loc+"</div>":"")+'</div></div><div class="tippy-score">'+(o.posts?'<div class="tippy-posts"><span class="tippy-posts-label">'+o.posts.label+'</span><span class="tippy-posts-value">'+o.posts.value+"</span></div>":"")+(o.rep?'<div class="tippy-rep"><span class="tippy-rep-label">'+o.rep.label+'</span><span class="tippy-rep-value">'+o.rep.value+"</span></div>":"")+(o.joined?'<div class="tippy-joined"><span class="tippy-joined-label">'+o.joined.label+'</span><span class="tippy-joined-value">'+o.joined.value+"</span></div>":"")+(o.lastAction?'<div class="tippy-last-action"><span class="tippy-last-action-label">'+o.lastAction.label+'</span><span class="tippy-last-action-value">'+o.lastAction.value+"</span></div>":"")+"</div></div>"),e.dataset.tooltipLoaded="true",t.popper.classList.remove("hidden")})))},onCreate:function(e){e.popper.classList.add("tippy-profile","hidden")}})}let n=document.querySelectorAll(".post .avatar, .big_list .who a, .big_list .avatar, .tag .nickname, .side_topics .who a, .lastarticles .topic > span a, .send_av a.avatar, .tag .list a.avatar, .big_list .zz .avatar, .stats .users a, .side_topics .thumbs a, #search .mtitle b, body#profile .profile-friends.thumbs a, body#group .big_list .aa.thumbs a, body#group .big_list .bb .nick a, body#members .big_list .aa.thumbs a, body#members .big_list .bb .nick a, .lastarticles .thumbs a, .lastarticles .topic .who a, .summary_details .nick a, .summary_details .avatar");document.querySelectorAll("body#profile .profile-friends.thumbs a img").forEach(e=>e.removeAttribute("title")),document.body.id==="online"&&(n=[...n,...document.querySelectorAll(".big_list li .aa.thumbs a, .big_list li .nick a")]),document.body.matches("#board")&&(n=[...n,...document.querySelectorAll(".lastreg a")]),n.forEach(e);const t=new MutationObserver((function(t){t.forEach((function(t){t.addedNodes.forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&(t.matches(".post .nick a, .send_av a.avatar, .tag .list a.avatar, .big_list .zz .avatar, .stats .users a, .side_topics .thumbs a, #search .mtitle b, body#profile .profile-friends.thumbs a, body#group .big_list .aa.thumbs a, body#group .big_list .bb .nick a, body#members .big_list .aa.thumbs a, body#members .big_list .bb .nick a, .lastarticles .thumbs a, .lastarticles .topic .who a, .summary_details .nick a, .summary_details .avatar")?e(t):t.querySelectorAll(".post .nick a, .send_av a.avatar, .tag .list a.avatar, .big_list .zz .avatar, .stats .users a, .side_topics .thumbs a, #search .mtitle b, body#profile .profile-friends.thumbs a, body#group .big_list .aa.thumbs a, body#group .bb .nick a, body#members .big_list .aa.thumbs a, body#members .bb .nick a, .lastarticles .thumbs a, .lastarticles .topic .who a, .summary_details .nick a, .summary_details .avatar").forEach(e))}))}))}));t.observe(document.body,{childList:!0,subtree:!0})}initUserTooltips();
//Stats fix
(function(){const e=document.querySelector("#board .stats.List .zz.right.Sub.Item div");if(e){e.style.visibility="visible",e.style.display="block",e.style.opacity="1";const t=e.querySelector("span");t&&t.previousSibling&&(t.previousSibling.nodeType===Node.TEXT_NODE?t.previousSibling.textContent="":t.previousSibling.nodeType===Node.ELEMENT_NODE&&t.previousSibling.remove());e.querySelectorAll("span").forEach(((e,t)=>{const n=e.nextSibling;n&&n.nodeType===Node.TEXT_NODE&&","===n.textContent.trim()&&(n.textContent="")}))}})();















